<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜索页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        input[type="text"] {
            padding: 10px;
            width: 70%;
            margin-right: 10px;
        }
        button {
            padding: 10px;
        }
    </style>
</head>
<body>

<h1>搜索页面</h1>
<input type="text" id="searchInput1" placeholder="请输入搜索关键字1">
<input type="text" id="searchInput2" placeholder="请输入搜索关键字2">
<button onclick="search()">搜索</button>

<table id="resultsTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>名称</th>
            <th>描述</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody id="resultsBody">
        <!-- 搜索结果将显示在这里 -->
    </tbody>
</table>

<script>
    // 封装类 ApiResponse
    class ApiResponse {
        constructor(response) {
            this.returnCode = response.returnCode;
            this.resultData = response.resultData;
        }

        getReturnCode() {
            return this.returnCode;
        }

        getResultData() {
            return this.resultData;
        }
    }

    // 封装类 FetchResult
    class FetchResult {
        constructor(response) {
            this.apiResponse = new ApiResponse(response);
            this.success = this.apiResponse.getReturnCode() === 200;
        }

        isSuccess() {
            return this.success;
        }

        getReturnCode() {
            return this.apiResponse.getReturnCode();
        }

        getResultData() {
            return this.apiResponse.getResultData();
        }
    }

// 封装的函数，用于访问后台接口
function fetchData(formData, endpoint) {
    const queryString = Array.from(formData.entries()).map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`).join('&');// 去掉方括号
    return fetch(`${endpoint}?${queryString}`)
    // return fetch(`${endpoint}?${formData}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('网络响应有问题');
            }
            return response.json(); // 返回解析后的 JSON 数据
        })
        .then(responseData => new FetchResult(responseData)); // 返回 FetchResult 实例
}

    function search() {

        const input1 = document.getElementById('searchInput1').value;
        const input2 = document.getElementById('searchInput2').value;
        const resultsBody = document.getElementById('resultsBody');
        resultsBody.innerHTML = ''; // 清空结果表格

        const formData1 = new FormData();
        formData1.append('username', 'John');
        formData1.append('email', 'john@example.com');


        let formData = new FormData();
        formData.append('name', 'John');
        formData.append('gender', '1');
        const queries = [input1, input2].filter(query => query); // 过滤掉空的条件

        // 计算 FormData 的条目数量
        let count = 0;
        for (let [key, value] of formData.entries()) {
            count++;
        }

        // 调用封装的 fetchData 函数
        if (count > 0) {
            let results = fetchData(formData, '/search')
            console.log(results);
                // .then(response => response.json())
                // .then(fetchResult => {
                //     if (!fetchResult.isSuccess()) {
                //         resultsBody.innerHTML = '<tr><td colspan="4">搜索失败，错误代码: ' + fetchResult.getReturnCode() + '</td></tr>';
                //         return;
                //     }

                //     const data = fetchResult.getResultData();
                //     if (data.length === 0) {
                //         resultsBody.innerHTML = '<tr><td colspan="4">未找到结果</td></tr>';
                //         return;
                //     }

                //     data.forEach(item => {
                //         const row = document.createElement('tr');
                //         row.innerHTML = `
                //             <td>${item.id}</td>
                //             <td>${item.name}</td>
                //             <td>${item.description}</td>
                //             <td><button onclick="edit(${item.id})">修改</button></td>
                //         `;
                //         resultsBody.appendChild(row);
                //     });
                // })
                // .catch(error => {
                //     console.error('发生错误:', error);
                //     resultsBody.innerHTML = '<tr><td colspan="4">搜索过程中出现错误</td></tr>';
                // });
        } else {
            alert('请至少输入一个搜索条件');
        }
    }

    function edit(id) {
        const newName = prompt("修改名称:");
        const newDescription = prompt("修改描述:");
        if (newName !== null && newDescription !== null) {
            alert(`ID: ${id}, 新名称: ${newName}, 新描述: ${newDescription}`);
            // 这里可以添加调用修改接口的逻辑
        }
    }
</script>

</body>
</html>
